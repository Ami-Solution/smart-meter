box: hseeberger/scala-sbt
build:
  steps:
    - install-packages:
        name: install git
        packages: git vim
    - add-to-known_hosts:
        name: add-to-known_hosts
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa
    - add-ssh-key:
        name: add-ssh-key
        keyname: GITHUB_SSH_KEY
    - script:
        name: git setup
        code: |
#          mkdir /master_docker
#          pushd /master_docker
          git config --global user.email "info@logimethods.com"
          git config --global user.name "Logimethods Wercker"
          git clone -b master_docker --progress --single-branch https://github.com/Logimethods/smart-meter.git /master_docker
#          popd
    - script:
        name: Set properties to Dockerfile
        code: |
          ./set_properties_to_dockerfile_templates.sh
    - script:
        name: app-batch
        code: |
          cp ./dockerfile-app-batch/Dockerfile /master_docker/dockerfile-app-batch
    - script:
        name: git push
        code: |
          pushd /master_docker
          git status
          echo "GIT ADD"
          git add --all .
          echo "GIT COMMIT"
          git commit -a -m "${WERCKER_GIT_COMMIT} at ${WERCKER_MAIN_PIPELINE_STARTED} by WERCKER"
          echo "GIT STATUS"
          git status
          echo "GIT PUSH"
          ls -als /master_docker
          git push origin HEAD:master_docker
